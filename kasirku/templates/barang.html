{% extends 'base.html' %}

{% block content %}


    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
    <center>
      <h1>Input Order</h1>
    </center>
    <section>
      <div class="main-content">
        <div class="container mt-7">
            <div class="col">
              <div class="card shadow">
                <div class="card-header border-0">
                  <h3 class="mb-0">Daftar Barang</h3>
                </div>
                
                <div class="table-responsive">
                  <table class="table align-items-center table-flush">
                    <thead class="thead-light">
                      <tr>
                        <th scope="col">Nama Barang</th>
                        <th scope="col">KODE Barang</th>
                        <th scope="col">HARGA</th>
                        <th scope="col">ADD TO ORDER</th>
                        <th scope="col"></th>
                      </tr>
                    </thead>
                    {% for barang in barangs %}
                    <tbody>
                      <tr>
                        <th scope="row">
                          <div class="media align-items-center">
                            <div class="media-body">
                              <span class="mb-0 text-sm">{{ barang.barang }}</span><br> Stok: {{ barang.quantity }}
                            </div>
                          </div>
                        </th>
                        <td>
                            {{ barang.kode }}
                        </td>
                        <td>
                            Rp.{{ barang.harga }}
                        </td>
                        <td>
                            <div class="control">
                                <form action="{% url 'add_cart' barang.id %}" method="post">
                                    {{ cart_product_form }}
                                    {% csrf_token %}
                                    <input class="button is-primary" type="submit" value="Beli" style="width:30px; height:20px; padding:0px;font-size: 12px;">
                                </form>
                            </div>
                        </td>
                        
                        <td class="text-right">
                          <div class="dropdown">
                            <a class="btn btn-sm btn-icon-only text-light" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                              <i class="fas fa-ellipsis-v"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right dropdown-menu-arrow">
                              <a class="dropdown-item" href="#">Action</a>
                              <a class="dropdown-item" href="#">Another action</a>
                              <a class="dropdown-item" href="#">Something else here</a>
                            </div>
                          </div>
                        </td>
                      </tr>
                      {% endfor %}
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="container mt-7">
                <div class="col">
                  <div class="card shadow">
                    <div class="card-header border-0">
                      <h3 class="mb-0">Input Order</h3>
                    </div>
                    <div class="table-responsive">
                      {% if cart %}
                      <div class="table">
                          <table class="table is-narrow">
                              <thead>
                                  <th>Produk</th>
                                  <th>Jumlah</th>
                                  <th>Harga</th>
                                  <th></th>
                              </thead>
                              {% for item in cart %}
                                {% with product=item.product %}
                                    <tbody>
                                        <tr>
                                            <td class="is-size-6-mobile">
                                                {{ product.barang }} <br> Stok: {{ item.stok }}
                                            </br>
                                            <td>
                                              <button class="input-group-text decrement-btn">-</button>
                                              <input type="text" name="quantity" class="form-control qty-input text-center" value="{{ item.quantity }}">
                                              <button class="input-group-text increment-btn">+</button>
                                            </td>
                                            <td>{{ item.total_price }}</td>
                                            <td><button class="button is-danger is-size-7-mobile"><a href="{% url 'remove_cart' product.id %}">Hapus</a></button></td>
                                        </tr>
                                    </tbody>
                                {% endwith %}
                              {% endfor %}

                              <tfoot>
                                  <tr>
                                      <td>Total harga</td>
                                      <td>{{ cart.get_total_quantity }}</td>
                                      <td>{{ cart.get_total_price }}</td>
                                  </tr>
                              </tfoot>
                          </table>
                      </div>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div> 
            </div>
          </div>
        </div>
      </div>  
    </section>

{% endblock %}

{% block script %}
<script>
  $(document).ready(function () {
    $('.increment-btn').click(function (e) {
      e.preventDefault();

      var quantityInput = $(this).siblings('.qty-input'); // Update selector to target the quantity input
      var incValue = parseInt(quantityInput.val(), 10);
      incValue = isNaN(incValue) ? 0 : incValue;

      if (incValue < 10) {
        incValue++;
        quantityInput.val(incValue);
      }
    });

    $('.decrement-btn').click(function (e) {
      e.preventDefault();

      var quantityInput = $(this).siblings('.qty-input'); // Update selector to target the quantity input
      var decValue = parseInt(quantityInput.val(), 10);
      decValue = isNaN(decValue) ? 0 : decValue;

      if (decValue > 0) {
        decValue--;
        quantityInput.val(decValue);
      }
    });


  });
</script>
{% endblock %}
